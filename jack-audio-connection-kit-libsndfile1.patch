--- jack-audio-connection-kit-0.34.0/example-clients/capture_client.c.orig	Thu May 16 01:16:57 2002
+++ jack-audio-connection-kit-0.34.0/example-clients/capture_client.c	Thu Oct 31 11:47:27 2002
@@ -155,7 +155,7 @@
 					}
 				}
 				
-				if (sf_writef_double (info->sf, fbuf, buf->nframes, 1) != buf->nframes) {
+				if (sf_writef_double (info->sf, fbuf, buf->nframes) != buf->nframes) {
 					char errstr[256];
 					sf_error_str (0, errstr, sizeof (errstr) - 1);
 					fprintf (stderr, "cannot write data to sndfile (%s)\n", errstr);
@@ -233,10 +233,27 @@
 
 	sf_info.samplerate = jack_get_sample_rate (info->client);
 	sf_info.channels = info->channels;
-	sf_info.format = SF_FORMAT_WAV|SF_FORMAT_PCM;
-	sf_info.pcmbitwidth = info->bitdepth;
+	sf_info.format = SF_FORMAT_WAV;
+	switch(info->bitdepth) {
+		case 8:
+			sf_info.format |= SF_FORMAT_PCM_S8;
+			break;
+		case 16:
+			sf_info.format |= SF_FORMAT_PCM_16;
+			break;
+		case 24:
+			sf_info.format |= SF_FORMAT_PCM_24;
+			break;
+		case 32:
+			sf_info.format |= SF_FORMAT_PCM_32;
+			break;
+		default:
+			fprintf(stderr, "unsupported bit depth: %d\n",info->bitdepth);
+			jack_client_close(info->client);
+			exit (1);
+	}
 
-	if ((info->sf = sf_open_write (info->path, &sf_info)) == NULL) {
+	if ((info->sf = sf_open (info->path, SFM_WRITE, &sf_info)) == NULL) {
 		char errstr[256];
 		sf_error_str (0, errstr, sizeof (errstr) - 1);
 		fprintf (stderr, "cannot open sndfile \"%s\" for output (%s)\n", info->path, errstr);
